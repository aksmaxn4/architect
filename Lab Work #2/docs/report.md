# Лабораторная работа №2  
## Тема: Использование нотации C4 Model для проектирования архитектуры программной системы  
## Проект: Информационная система для мониторинга арбитражных ситуаций между CEX и DEX  

**Цель работы:**  
Получить практический опыт применения нотации C4 Model для фиксации архитектурных решений на разных уровнях детализации: контекст системы, контейнеры и компоненты.

---

## 1. Диаграмма системного контекста

Диаграмма системного контекста отражает систему как единый программный комплекс и описывает её взаимодействие с внешними акторами и внешними программными системами.

Диаграмма: https://drive.google.com/file/d/1BZghqdy2G_C5T8oljhZLgoL1156cxHRQ/view?usp=sharing

### Основные элементы контекста

#### Пользователь-трейдер  
Основной актор системы. Использует веб-интерфейс для мониторинга арбитражных возможностей, настройки торговых пар, порогов спредов, каналов уведомлений. Получает обновления в режиме, близком к реальному времени.

#### Администратор системы  
Управляет конфигурациями платформы, списком подключённых бирж, параметрами частоты опроса, ключами API, логами ошибок и стабильностью работы.

#### Информационная система мониторинга арбитражных ситуаций (Система)  
Центральный программный комплекс. Выполняет сбор ценовых данных с CEX и DEX, анализирует арбитражные возможности, сохраняет исторические данные и отправляет уведомления пользователю.

### Внешние системы

#### Централизованные биржи (CEX)  
Источник данных о котировках, порядке ордербуков и ликвидности. Взаимодействие осуществляется через WebSocket API.

#### Децентрализованные биржи (DEX)  
Предоставляют данные пулов ликвидности и смарт-контрактов через RPC или API агрегаторов.

#### Сервисы уведомлений  
Telegram Bot API, Email-шлюз или другие каналы доставки уведомлений.

---

## 2. Диаграмма контейнеров

Диаграмма контейнеров описывает высокоуровневую структуру системы: программные модули и то, как они взаимодействуют между собой.

### Выбранный архитектурный стиль

Используется микросервисная архитектура, дополненная event-driven взаимодействием через брокер сообщений. 

Диаграмма: https://drive.google.com/file/d/1gL4OZ2n37HtsMcMM0nq80XcRVCPMSklY/view?usp=sharing

### Контейнеры системы

#### Web-клиент (Browser SPA)  
Интерфейс для пользователя-трейдера. Предоставляет визуализацию данных, управление конфигурацией. Работает через HTTPS с Backend API.

#### Backend API (Application Server)  
Реализует пользовательские сценарии, обработку запросов, управление пользователями и настройками. Обеспечивает доступ к данным в БД и взаимодействие с Message Broker.

#### Сервис сбора и анализа данных (Market Data & Arbitrage Engine)  
Осуществляет регулярный опрос бирж, нормализует данные, вычисляет арбитражные возможности и публикует события в очередь сообщений.

#### Сервис уведомлений (Notifications Service)  
Получает события о найденных арбитражных возможностях, применяет пользовательские фильтры и отправляет уведомления через Telegram и Email.

#### База данных (PostgreSQL / Time-Series DB)  
Хранит пользователей, настройки, конфигурацию мониторинга, исторические данные и арбитражные возможности.

#### Message Broker (RabbitMQ / Kafka)  
Обеспечивает асинхронное взаимодействие между Backend API, аналитическим сервисом и сервисом уведомлений.

---

## 3. Диаграмма компонентов (Backend API)

Backend API является центральным контейнером пользовательских сценариев. Он включает следующие компоненты:

Диаграмма: https://drive.google.com/file/d/1Ma-5WUA5BNYIeAT3lKXKAFVsfpgLk841/view?usp=sharing

### Основные компоненты Backend API

- **API Controllers**  
  Обрабатывают входящие HTTP-запросы, вызывают доменные сервисы.

- **Auth & User Management**  
  Аутентификация, авторизация, role-based доступ.

- **Monitoring Configuration Service**  
  Управляет списком бирж, торговыми парами, порогами спреда, частотой опроса.

- **Arbitrage Opportunities Service**  
  Предоставляет пользователю сведения о найденных арбитражных возможностях, поддерживает фильтрацию, сортировку, историю.

- **Notification Settings Service**  
  Управляет настройками уведомлений, публикует команды на отправку событий в Message Broker.

- **Persistence Layer**  
  Инкапсулирует доступ к базе данных.

- **Message Broker Client**  
  Публикует события для дальнейшей обработки другими сервисами.

- **Logging & Metrics**  
  Логирование ошибок, аудит, сбор технических метрик.

---

## 4. Диаграмма компонентов (Notifications Service)

Сервис уведомлений отвечает за обработку событий и доставку уведомлений пользователю.

Диаграмма: https://drive.google.com/file/d/1lvHrddS8DUIXVByelgqJfavJFiH0AWuC/view?usp=sharing

### Основные компоненты Notifications Service

- **Event Listener**  
  Подписывается на очередь сообщений, получает события о найденных арбитражных ситуациях.

- **Notification Rules Processor**  
  Применяет пользовательские настройки: пороги прибыли, частоту, приоритет уведомлений.

- **Message Formatter**  
  Формирует текст уведомлений для Telegram и Email.

- **Telegram Delivery Adapter**  
  Отправляет сообщения через Telegram Bot API.

- **Email Delivery Adapter**  
  Отправляет уведомления через SMTP или внешний email-провайдер.

- **User Settings Repository**  
  Получает актуальные настройки пользователей из базы данных.

- **Logging & Metrics**  
  Фиксирует ошибки доставки, собирает статистику по отправленным уведомлениям.
